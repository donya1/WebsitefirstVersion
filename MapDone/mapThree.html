<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>Points on a map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="Research.css">
    <style>

    #map {
        width: 100%;
        position:absolute;
        top:40px;
        left:0px;
        height:80%;
      }

    #legend {
      position:relative;
      top:90px;
      left:10px;
      width:332px;
      height:159px;
      background-color:#f1f3f1;
      border-radius: 3px;
      border: 1px solid rgba(0, 0, 0, 0.4);
      box-shadow:2px 2px 2px #b1b1b1;
      z-index:3;
    }

    #Con {
      position:absolute;
      bottom:0px;
      left:10px;
      padding:5px;
      font-family:'Open Sans';
      font-size:12px;
      line-height:1.3;
    }

    .colorBox {
      width:10px;
      height:10px;
      margin-bottom:10px;
      border: 1px solid rgba(0, 0, 0, 0.25);
    }

    .label {
      float:left;
      margin-top:-22px;
      margin-left:17px;
      width:290px;
    }

    #panBox {
      background-color:#6a3d9a;
    }

    #obsBox {
      background-color:#1f78b4;
    }

    #disBox {
      background-color:#b2df8a;
    }

    #shltBox {
      background-color:#33a02c;
    }

    #salBox {
      background-color:#fb9a99;
    }

    #loiBox {
      background-color:#e31a1c;
    }

    #sitBox {
      background-color:#ff7f00;
    }

    .mobileLegend {
      width:60px;
      height:25px;
      background: #f1f3f1;
      z-index:3;
      position:absolute;
      top:50px;
      left:10px;
      border-radius:2px;
      display:none;
      font-family:Open Sans;
    }

    .mobileLegend p{
      margin:auto;
    }

@media only screen and (max-width: 1279px) {
    .mobileLegend {
      display:block;
    }
}

@media only screen and (min-width: 1279px) {

    #legend {
      display:block;
      top:50px;
    }
}

}

    </style>
  </head>
  <body>

    <nav>
      <ul class="nav">
        <li><a href="index.html">Home</a></li>
        <li><a class="current" href="Research.html">Research</a></li>
        <li><a href="OurTeam.html">Our Team</a></li>
        <li><a href="Contact.html">Contact</a></li>
      </ul>
      <ul class="lang">
        <li><a href="#" language='english' class='active' id="Eng">EN</a></li>
        <li><a href="#" language='french'>FR</a></li>
      </ul>
    </nav>

    <div class="mapParts">

      <div id='map'></div>

      <div id="legend">
        <div id="Con">
          <div id="pan"><div class="colorBox" id="panBox"></div><p class="label">Panhandling/Mendier</p></div>
          <div id="obs"><div class="colorBox" id="obsBox"></div><p class="label">Obstructing/Provoquer une Obstruction</p></div>
          <div id="dis"><div class="colorBox" id="disBox"></div><p class="label">Disorder/Occasionner des Troubles</p></div>
          <div id="shlt"><div class="colorBox" id="shltBox"></div><p class="label">Sheltering/Construire un Abri de Fortune</p></div>
          <div id="sal"><div class="colorBox" id="salBox"></div><p class="label">Salvaging/R&eacute;cup&eacute;rer et R&eacute;utiliser des D&eacute;chets</p></div>
          <div id="loi"><div class="colorBox" id="loiBox"></div><p class="label">Loitering/Fl&acirc;ner</p></div>
          <div id="sit"><div class="colorBox" id="sitBox"></div><p class="label">Resting or Sleeping/Se Reposer ou S'allonger au Sol</p></div>
        </div>
    </div>

    <button class="mobileLegend">Legend</button>

    </div>

       <div class="content">
      <div class= "caption"><h2>Breakdown of Offence Types by region:<span class='capDes'>&nbsp; The percentage of types of behaviours criminalized by region is visualized. The number at the center of the donut chart represents the total number of behaviours/offence types in each cluster. Zoom in and out to inspect different regions.</span></h2></div>

    <div class="mapMenu">
      <h1>Mapping Visualizations</h1>
      <ul>
        <li><a href="mapOne.html">by the Numbers</a></li>
        <li><a href="mapTwo.html">by Offence Type</a></li>
        <li><a class="current" href="mapThree.html">by Behaviours Criminalized</a></li>
      </ul>
    </div>
    <div class="writeUp">

      <p class="par1">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vestibulum gravida iaculis. In aliquam metus et nunc finibus, a viverra purus ultrices. Nullam sollicitudin mauris eu risus finibus volutpat eu in ex. Vestibulum interdum elit ex, eu facilisis justo fermentum eget. Donec purus libero, hendrerit sed lectus id, mattis mollis quam. Duis pellentesque dui ut arcu hendrerit accumsan. Suspendisse id sapien nec purus elementum elementum interdum eu neque. Integer mauris turpis, sagittis nec metus ac, faucibus ullamcorper tortor. Suspendisse molestie id eros eu efficitur. Fusce congue vestibulum lectus, eu rhoncus nibh mollis vitae. Sed non sodales tortor, sed condimentum magna. Aliquam at viverra nisl, at tincidunt eros. Pellentesque dapibus nisi dui, sit amet viverra est ornare vitae. Quisque imperdiet lacus eget neque auctor aliquet. In interdum auctor nisi, quis tristique nulla.</p>

      <p class="par2">Fusce at sapien id erat rutrum dictum id nec tellus. Nam urna erat, volutpat eget lectus ut, porttitor condimentum lacus. Aliquam id vehicula leo, at porta nisl. Aliquam efficitur feugiat dui, nec ultricies sem. Ut interdum iaculis ultrices. Maecenas sed porttitor nisl, in suscipit nulla. Vestibulum auctor, purus accumsan vehicula efficitur, quam mi egestas sapien, ut congue urna ipsum at metus. Phasellus tristique luctus lacus at sodales. Morbi fringilla tortor non finibus elementum. Maecenas porttitor tincidunt cursus. Quisque felis nulla, efficitur tempus consectetur sit amet, lacinia vitae dolor. In bibendum elit quis lorem luctus pulvinar. Phasellus velit neque, eleifend eget volutpat eu, porttitor nec orci.</p>

      <p class="par3">Vivamus vitae ante posuere velit lobortis accumsan. Maecenas placerat posuere dignissim. Aliquam molestie luctus justo vitae maximus. Duis posuere tellus sapien, vel tincidunt libero tempor in. Suspendisse at odio sed nibh ornare pharetra fringilla eget augue. Curabitur ultricies laoreet faucibus. Curabitur vel vehicula magna. Aliquam erat volutpat. Phasellus a enim vitae quam semper fermentum quis efficitur velit. Vivamus vitae porta lorem, nec maximus leo. Suspendisse eleifend nisl quam, nec posuere nibh auctor ac. Aenean sit amet vehicula dolor. Morbi eleifend arcu vel sem euismod, eu vestibulum dolor congue. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Morbi vel odio sit amet tellus malesuada aliquet.</p>

      <p class="par4">Fusce ornare bibendum odio ac consectetur. Nulla mattis aliquet scelerisque. Vivamus tempor leo et ligula vehicula, quis pretium risus vestibulum. Nullam commodo rhoncus massa, ac egestas magna accumsan vel. Pellentesque ac fringilla elit. Curabitur auctor eros nec felis suscipit, ac imperdiet leo blandit. Nunc porttitor rhoncus bibendum. Morbi ut varius ante. Sed vel tincidunt lacus. Curabitur ut ornare lectus. In egestas dictum erat, ac vulputate justo fringilla id. Cras lacinia dui urna, sit amet laoreet lacus dapibus vitae. Curabitur cursus eleifend elit eu imperdiet. Duis et rutrum diam.</p>

      <p class="par5">Curabitur eget ipsum hendrerit, finibus dui ac, iaculis odio. Donec ac fringilla nisl, in bibendum dolor. Phasellus quis nibh lorem. Nulla eu tempor elit. Donec ipsum diam, fringilla at eleifend eu, mattis quis leo. Curabitur ipsum ipsum, mollis at nisl a, rutrum bibendum dui. Pellentesque vel ante ante. In quis mattis ipsum, vel condimentum urna. Sed et mattis tortor, quis fermentum velit.</p>

      <p class="par6">Integer mattis nisl sed arcu convallis varius. Vivamus ut leo ultricies, placerat ligula quis, porta arcu. Quisque laoreet cursus lectus, in accumsan arcu mattis sit amet. Donec efficitur mauris erat, at lobortis diam accumsan a. Suspendisse a dui varius, egestas ex nec, ullamcorper ex. Aliquam fermentum risus massa, eget molestie ligula suscipit non. Vestibulum auctor ante tellus, nec sollicitudin enim imperdiet sed. Donec quis arcu pulvinar, congue mauris quis, ultrices sapien. Nullam ornare dignissim vehicula. In hac habitasse platea dictumst. Donec faucibus metus quis ligula rhoncus, at luctus ligula lobortis.</p>

      <p class="par7">In hac habitasse platea dictumst. Mauris ac turpis blandit, lobortis ex vitae, faucibus odio. Sed diam eros, volutpat ut egestas nec, varius in nisi. Nunc a dapibus sem, quis sodales massa. Pellentesque venenatis cursus vestibulum. Cras placerat, dolor vel laoreet scelerisque, nisl est dictum dolor, a hendrerit tellus ex a augue. Vestibulum maximus urna ut nisl blandit semper. Vivamus vulputate aliquet nisl, sed lobortis sapien pharetra sit amet. Ut mattis justo id nisi convallis tristique. Phasellus commodo est in neque dictum pellentesque. Etiam condimentum purus vel velit dictum volutpat aliquam ut libero.</p>

      <p class="par8">In et dignissim lorem. Nullam turpis arcu, egestas non convallis consectetur, elementum vel velit. Aenean id nunc at sem condimentum elementum. Fusce dapibus.</p>

    </div>

    <footer>
      <hr>

      <div class=bottomNav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="Research.html">Research</a></li>
          <li><a href="OurTeam.html">Our Team</a></li>
          <li><a href="Contact.html">Contact</a></li>
        </ul>
      </div>
    </footer>

  </div>




  <script>

    mapboxgl.accessToken = 'pk.eyJ1IjoiZG9ueWFhYSIsImEiOiJja2FmcHVzMjUwMHl1MnJyOGJjZ3d1ZDN2In0.Xpcbdw2ReubEMhFvbYn_7w'; // replace this with your access token

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v10', // replace this with your style URL
      center: [-104.750596, 58.585901],
      zoom: 2.8
    });

    map.addControl(new mapboxgl.NavigationControl());

    const pan = ['==', ['get', 'OffenceType'], 'Panhandling / Mendier'];
    const obs = ['==', ['get', 'OffenceType'], 'Obstructing / Provoquer une obstruction'];
    const dis = ['==', ['get', 'OffenceType'], 'Disorder / Occasionner des troubles'];
    const shlt = ['==', ['get', 'OffenceType'], 'Sheltering / Construire un abri de fortune'];
    const salv = ['==', ['get', 'OffenceType'], 'Salvaging / Récupérer et réutiliser des déchets'];
    const loiter = ['==', ['get', 'OffenceType'], 'Loitering / Flâner'];
    const sit = ['==', ['get', 'OffenceType'], "Resting or Sleeping / Se reposer ou S'allonger au sol"];

    var colors = ['#6a3d9a', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#ff7f00'];

    map.on('load', () => {
      map.addSource('Laws' ,{
        'type': 'geojson',
        'data': 'https://donya1.github.io/WebsitefirstVersion/GeojsonData/FinalDataSingleOffencesLongLatFixed.geojson',
        'cluster': true,
        'clusterRadius':80,
        'clusterMaxZoom': 10,
        'clusterProperties': {
          'pan': ["+", ['case', pan, 1, 0]],
          'obs': ["+", ['case', obs, 1, 0]],
          'dis': ["+", ['case', dis, 1, 0]],
          'shlt': ["+", ['case', shlt, 1, 0]],
          'salv': ["+", ['case', salv, 1, 0]],
          'loiter': ["+", ['case', loiter, 1, 0]],
          'sit': ["+", ['case', sit, 1, 0]]
        }
      });

      // circle and symbol layers for rendering individual earthquakes (unclustered points)
    // map.addLayer({
    //   'id': 'Law_circle',
    //   'type': 'circle',
    //   'source': 'Laws',
    //   'filter':['=', 'cluster', true],
    //   'paint': {
    //     'circle-color': [
    //       'case',
    //       pan,
    //       colors[0],
    //       obs,
    //       colors[1],
    //       dis,
    //       colors[2],
    //       shlt,
    //       colors[3],
    //       salv,
    //       colors[4],
    //       loiter,
    //       colors[5],
    //       colors[6]
    //     ],
    //     'circle-opacity': 0.6,
    //     'circle-radius': 7
    //   }
    // });

    map.addLayer({
      'id': 'Laws_label',
      'type': 'symbol',
      'source': 'Laws',
      'filter': ['!=', 'cluster', true],
      'layout': {
        'text-font': ['Open Sans Semibold', 'Arial Unicode MS Bold'],
        'text-size': 10
      },
      'paint': {
        'text-color': 'black'
      }
    });


      // objects for caching and keeping track of HTML marker objects (for performance)
      var markers = {};
      var markersOnScreen = {};
 
      function updateMarkers() {
      var newMarkers = {};
      var features = map.querySourceFeatures('Laws');
 
      // for every cluster on the screen, create an HTML marker for it (if we didn't yet),
      // and add it to the map if it's not there already
      for (var i = 0; i < features.length; i++) {
        var coords = features[i].geometry.coordinates;
        var props = features[i].properties;
        if (!props.cluster) continue;
        var id = props.cluster_id;
 
        var marker = markers[id];
        if (!marker) {
          var el = createDonutChart(props);
          marker = markers[id] = new mapboxgl.Marker({
            element: el
          }).setLngLat(coords);
        }
        newMarkers[id] = marker;
 
        if (!markersOnScreen[id]) marker.addTo(map);
      }

      // for every marker we've added previously, remove those that are no longer visible
      for (id in markersOnScreen) {
        if (!newMarkers[id]) markersOnScreen[id].remove();
      }
      markersOnScreen = newMarkers;
      }

      // after the GeoJSON data is loaded, update markers on the screen and do so on every map move/moveend
      map.on('data', function(e) {
        if (e.sourceId !== 'Laws' || !e.isSourceLoaded) return;
 
        map.on('move', updateMarkers);
        map.on('moveend', updateMarkers);
        updateMarkers();
      });


    });


    // code for creating an SVG donut chart from feature properties
    function createDonutChart(props) {
    var offsets = [];
    var counts = [
      props.pan,
      props.obs,
      props.dis,
      props.shlt,
      props.salv,
      props.loiter,
      props.sit
    ];
    var total = 0;
    for (var i = 0; i < counts.length; i++) {
      offsets.push(total);
      total += counts[i];
    }
    var fontSize =
      total >= 1000 ? 22 : total >= 100 ? 20 : total >= 10 ? 18 : 16;
    var r = total >= 1000 ? 50 : total >= 100 ? 32 : total >= 10 ? 24 : 18;
    var r0 = Math.round(r * 0.6);
    var w = r * 2;
 
    var html =
      '<div><svg width="' +
      w +
      '" height="' +
      w +
      '" viewbox="0 0 ' +
      w +
      ' ' +
      w +
      '" text-anchor="middle" style="font: ' +
      fontSize +
      'px sans-serif; display: block">';
 
    for (i = 0; i < counts.length; i++) {
      html += donutSegment(
        offsets[i] / total,
        (offsets[i] + counts[i]) / total,
        r,
        r0,
        colors[i]
      );
    }
    html +=
      '<circle cx="' +
      r +
      '" cy="' +
      r +
      '" r="' +
      r0 +
      '" fill="white" /><text dominant-baseline="central" transform="translate(' +
      r +
      ', ' +
      r +
      ')">' +
      total.toLocaleString() +
      '</text></svg></div>';
 
    var el = document.createElement('div');
    el.innerHTML = html;
    return el.firstChild;
  }
 
    function donutSegment(start, end, r, r0, color) {
      if (end - start === 1) end -= 0.00001;
      var a0 = 2 * Math.PI * (start - 0.25);
      var a1 = 2 * Math.PI * (end - 0.25);
      var x0 = Math.cos(a0),
      y0 = Math.sin(a0);
      var x1 = Math.cos(a1),
      y1 = Math.sin(a1);
      var largeArc = end - start > 0.5 ? 1 : 0;
 
    return [
      '<path d="M',
      r + r0 * x0,
      r + r0 * y0,
      'L',
      r + r * x0,
      r + r * y0,
      'A',
      r,
      r,
      0,
      largeArc,
      1,
      r + r * x1,
      r + r * y1,
      'L',
      r + r0 * x1,
      r + r0 * y1,
      'A',
      r0,
      r0,
      0,
      largeArc,
      0,
      r + r0 * x0,
      r + r0 * y0,
      '" fill="' + color + '" />'
      ].join(' ');
    }


  </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="Script.js"></script>
  </body>
</html>